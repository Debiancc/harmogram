// Generated by CoffeeScript 1.3.3
(function() {
  var Player;

  Player = (function() {

    function Player() {
      this.audioPlayers = [];
      this.currentPlaying = null;
      this.isPlaying = false;
      this.currentTrack = 0;
      this.initEvents();
      this;

    }

    Player.prototype.initEvents = function(el) {
      var _this = this;
      $(this).on('newAudio', function(e, el) {
        console.log('new source', el);
        _this.audioPlayers.push(el);
        return _this.renderPlaylist();
      });
      $(this).on('playLast', function(e) {
        return _this.playLast();
      });
      return $(this).on('playIndex', function(e, index) {
        if (_this.currentTrack === index && _this.isPlaying) {
          return _this.pauseCurrent();
        } else {
          _this.currentTrack = index;
          return _this.playCurrent();
        }
      });
    };

    Player.prototype.renderPlaylist = function() {
      var player, _i, _len, _ref, _results,
        _this = this;
      $('#playlist').html('');
      _ref = this.audioPlayers;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        player = _ref[_i];
        _results.push((function(player) {})(player));
      }
      return _results;
    };

    Player.prototype.pauseCurrent = function() {
      var audio, current, _fn, _i, _len;
      current = _.filter(this.audioPlayers, function(a) {
        return a.paused === false;
      });
      _fn = function(audio) {
        return audio.pause();
      };
      for (_i = 0, _len = current.length; _i < _len; _i++) {
        audio = current[_i];
        _fn(audio);
      }
      $(Sounder.renderer).trigger('pause');
      return this.isPlaying = false;
    };

    Player.prototype.playLast = function() {
      var last;
      if (this.isPlaying) {
        this.pauseCurrent();
      }
      last = this.audioPlayers[this.audioPlayers.length - 1];
      last.play();
      $(Sounder.renderer).trigger('start');
      return this.isPlaying = true;
    };

    Player.prototype.playCurrent = function() {
      var current, i;
      if (this.isPlaying) {
        this.pauseCurrent();
      }
      i = this.audioPlayers.indexOf(this.currentTrack);
      current = this.audioPlayers[i];
      current.play();
      $(Sounder.renderer).trigger('start');
      return this.isPlaying = true;
    };

    return Player;

  })();

  (function() {
    return Sounder.player = new Player;
  })();

}).call(this);
